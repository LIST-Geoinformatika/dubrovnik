L.NonTiledLayer=L.Class.extend({includes:L.Mixin.Events,options:{attribution:"",opacity:1,pane:null,zIndex:void 0,minZoom:0,maxZoom:19},key:"",initialize:function(a){L.setOptions(this,a)},onAdd:function(a){this._map=a,this._div||(this._div=L.DomUtil.create("div","leaflet-image-layer")),this.options.pane?this._pane=this.options.pane:this._pane=this._map.getPanes().overlayPane,a.options.zoomAnimation&&L.Browser.any3d&&a.on("zoomanim",this._animateZoom,this),this._map.on("moveend",this._update,this),this._pane.appendChild(this._div),this._bufferImage=this._initImage(),this._currentImage=this._initImage(),this._update()},onRemove:function(a){this._pane.removeChild(this._div),this._div.removeChild(this._bufferImage),this._div.removeChild(this._currentImage),this._map.off("moveend",this._update,this),a.options.zoomAnimation&&a.off("zoomanim",this._animateZoom,this)},addTo:function(a){return a.addLayer(this),this},setOpacity:function(a){return this.options.opacity=a,this._currentImage&&this._updateOpacity(this._currentImage),this._bufferImage&&this._updateOpacity(this._bufferImage),this},bringToFront:function(){return this._div&&this._pane.appendChild(this._div),this},bringToBack:function(){return this._div&&this._pane.insertBefore(this._div,this._pane.firstChild),this},getAttribution:function(){return this.options.attribution},_initImage:function(){var a=L.DomUtil.create("img","leaflet-image-layer");return void 0!==this.options.zIndex&&(a.style.zIndex=this.options.zIndex),this._div.appendChild(a),this._map.options.zoomAnimation&&L.Browser.any3d?L.DomUtil.addClass(a,"leaflet-zoom-animated"):L.DomUtil.addClass(a,"leaflet-zoom-hide"),this._updateOpacity(a),L.extend(a,{galleryimg:"no",onselectstart:L.Util.falseFn,onmousemove:L.Util.falseFn,onload:L.bind(this._onImageLoad,this)}),a},redraw:function(){return this._map&&this._update(),this},_animateZoom:function(a){this._currentImage._bounds&&this._animateImage(this._currentImage,a),this._bufferImage._bounds&&this._animateImage(this._bufferImage,a)},_animateImage:function(a,b){var c=this._map,d=a._scale*c.getZoomScale(b.zoom),e=a._bounds.getNorthWest(),f=a._bounds.getSouthEast(),g=c._latLngToNewLayerPoint(e,b.zoom,b.center),h=c._latLngToNewLayerPoint(f,b.zoom,b.center)._subtract(g),i=g._add(h._multiplyBy(.5*(1-1/d)));a.style[L.DomUtil.TRANSFORM]=L.DomUtil.getTranslateString(i)+" scale("+d+") ",a._lastScale=d},_resetImage:function(a){if(a._bounds){var b=new L.Bounds(this._map.latLngToLayerPoint(a._bounds.getNorthWest()),this._map.latLngToLayerPoint(a._bounds.getSouthEast())),c=b.getSize();L.DomUtil.setPosition(a,b.min),a.style.width=c.x+"px",a.style.height=c.y+"px"}},_getClippedBounds:function(){var a=this._map.getBounds(),b=a.getNorthWest().lng,c=a.getNorthWest().lat,d=a.getSouthEast().lng,e=a.getSouthEast().lat;b=(b+180)%360-180,c>85.05&&(c=85.05),-85.05>e&&(e=-85.05),-180>b&&(b=-180),d>180&&(d=180);var f=new L.LatLng(c,b),g=new L.LatLng(e,d);return new L.LatLngBounds(f,g)},_update:function(){if(this.options.minZoom&&this._map.getZoom()<this.options.minZoom||this.options.maxZoom&&this._map.getZoom()>this.options.maxZoom)return this._currentImage.src=L.Util.emptyImageUrl,this._bufferImage.src=L.Util.emptyImageUrl,this._div.style.visibility="hidden",void(this._addInteraction&&this._addInteraction(null));this._div.style.visibility="visible";var a=this._getClippedBounds(),b=this._map.latLngToContainerPoint(a.getNorthWest()),c=this._map.latLngToContainerPoint(a.getSouthEast()),d=c.x-b.x,e=c.y-b.y;if(!(32>d||32>e)){1===this._bufferImage._lastScale&&this._resetImage(this._bufferImage),this._bufferImage._scale=this._bufferImage._lastScale,this._currentImage._scale=this._currentImage._lastScale=1,this._currentImage._bounds=a,this._resetImage(this._currentImage);var f=this._onImageUrlAsync,g=this._currentImage,h=a.getNorthWest()+"/"+a.getSouthEast()+"/"+ +d+"/"+ +e;this.key=h,g.key=h,this.getImageUrl?g.src=this.getImageUrl(a.getNorthWest(),a.getSouthEast(),d,e):this.getImageUrlAsync(a.getNorthWest(),a.getSouthEast(),d,e,h,function(a,b,c){f(g,a,b,c)})}},_onImageUrlAsync:function(a,b,c,d){a.key===b&&(a.src=c,a.tag=d,a.key=b)},_onImageLoad:function(a){if(a.target.src!==L.Util.emptyImageUrl&&this.key===a.target.key){this._addInteraction&&this._addInteraction(this._currentImage.tag),L.DomUtil.setOpacity(this._currentImage,this.options.opacity),L.DomUtil.setOpacity(this._bufferImage,0),this._bufferImage.src=L.Util.emptyImageUrl;var b=this._bufferImage;this._bufferImage=this._currentImage,this._currentImage=b,this.fire("load")}},_updateOpacity:function(a){L.DomUtil.setOpacity(a,this.options.opacity)}}),L.nonTiledLayer=function(){return new L.NonTiledLayer};