function heatmap(){var a=[];return $.ajax({type:"GET",url:"php/postgis_geojson.php?geotable=upit_lokinfo&geomfield=geom_wgs",contentType:"application/x-www-form-urlencoded;charset=utf-8",dataType:"json",success:function(b){for(var c=0;c<b.features.length;c++){var d=[];d.push(b.features[c].geometry.coordinates[1]),d.push(b.features[c].geometry.coordinates[0]),d.push("10"),a.push(d)}}}),a}function Upiti(){$.ajax({type:"GET",url:"php/postgis_geojson.php?geotable=upit&geomfield=geom_wgs",contentType:"application/x-www-form-urlencoded;charset=utf-8",dataType:"json",success:function(a){markers.clearLayers();for(var b=0;b<a.features.length;b++){var f,c=a.features[b].properties.vrsta,d=a.features[b].properties.naslov,e=a.features[b].properties.poruka,g=a.features[b].geometry.coordinates[1],h=a.features[b].geometry.coordinates[0];"vrsta1"==c?f=L.marker(L.latLng(g,h),{icon:greenIcon}):"vrsta2"==c?f=L.marker(L.latLng(g,h),{icon:redIcon}):"vrsta3"==c&&(f=L.marker(L.latLng(g,h),{icon:yellowIcon})),f.bindPopup("<b>"+d+"</b><br><br>"+e),markers.addLayer(f)}}})}function dodajTekstInfoAlat(){$('button[title="Info"]').prepend('<p id="explanationText">Odaberite alat<p>'),$('button[title="Info"]').css("width","100%"),$('button[title="Info"]:hover').css("background-color","white"),$('button[title="Info"]:hover').css("cursor","default")}function makniTekstInfoAlat(){$("#explanationText").remove(),$('button[title="Info"]').css("width","26px"),$(".leaflet-touch .leaflet-bar button").css("width","30px"),$("p:empty").remove(),$('button[title="Info"]:hover').css("cursor","pointer"),$('button[title="Info"]:hover').css("background-color","white")}var Attr='Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery \xa9 <a href="http://mapbox.com">Mapbox</a>',UrlOSM="http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",UrlDGU="http://geoportal.dgu.hr/wms";UrlGUP="https://dev.li-st.net/geoserver/up4c_du/wms",UrlHOK="http://geoportal.dgu.hr/services/hok/wms";var base=L.tileLayer.wms(UrlDGU,{layers:""}),dof_dgu=L.tileLayer.wms(UrlDGU,{layers:"DOF",srs:"EPSG:3765",format:"image/jpeg",attribution:"DOF 2011. (DGU)",zIndex:1,maxZoom:19}),hok_dgu=L.tileLayer.wms(UrlHOK,{layers:"HOK",srs:"EPSG:3765",format:"image/jpeg",attribution:"HOK (DGU)",zIndex:1,maxZoom:19,tileSize:500}),osm=new L.TileLayer(UrlOSM,{zIndex:1,attribution:'&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> Contributors',maxZoom:19}),namjena=new L.NonTiledLayer.WMS(UrlGUP,{layers:"up4c:v_namjena",transparent:!0,format:"image/png",zIndex:2}),promet=new L.NonTiledLayer.WMS(UrlGUP,{layers:"up4c:v_promet",transparent:!0,format:"image/png",zIndex:3}),telekomunikacija=new L.NonTiledLayer.WMS(UrlGUP,{layers:"up4c:v_telekomunikacija",transparent:!0,format:"image/png",zIndex:2}),energ_sustavi=new L.NonTiledLayer.WMS(UrlGUP,{layers:"up4c:v_energ_sustavi",transparent:!0,format:"image/png",zIndex:2}),voda=new L.NonTiledLayer.WMS(UrlGUP,{layers:"up4c:v_voda",transparent:!0,format:"image/png",zIndex:2}),odvodnja=new L.NonTiledLayer.WMS(UrlGUP,{layers:"up4c:v_odvodnja",transparent:!0,format:"image/png",zIndex:2}),bastina=new L.NonTiledLayer.WMS(UrlGUP,{layers:"up4c:v_zpb",transparent:!0,format:"image/png",zIndex:2}),ekomreza=new L.NonTiledLayer.WMS(UrlGUP,{layers:"up4c:v_nem",transparent:!0,format:"image/png",zIndex:2}),graditeljskabastina=new L.NonTiledLayer.WMS(UrlGUP,{layers:"up4c:v_grad_bastina",transparent:!0,format:"image/png",zIndex:2}),krajobraz=new L.NonTiledLayer.WMS(UrlGUP,{layers:"up4c:v_krajobraz",transparent:!0,format:"image/png",zIndex:2}),zpvo=new L.NonTiledLayer.WMS(UrlGUP,{layers:"up4c:v_zpvo",transparent:!0,format:"image/png",zIndex:2}),uredjenjezemljista=new L.NonTiledLayer.WMS(UrlGUP,{layers:"up4c:v_uredjenje_zemljista_a",transparent:!0,format:"image/png",zIndex:2}),urbanapravila=new L.NonTiledLayer.WMS(UrlGUP,{layers:"up4c:v_urbanapravila",transparent:!0,format:"image/png",zIndex:2}),posebnazastita=new L.NonTiledLayer.WMS(UrlGUP,{layers:"up4c:v_ppmz",transparent:!0,format:"image/png",zIndex:2}),naselja=new L.NonTiledLayer.WMS(UrlGUP,{layers:"up4c:v_naselja",format:"image/png",transparent:!0,zIndex:10}),gupgranice=new L.NonTiledLayer.WMS(UrlGUP,{layers:"up4c:v_granica_gup",transparent:!0,format:"image/png",zIndex:2}),katopcine=new L.NonTiledLayer.WMS(UrlGUP,{layers:"up4c:dkp_kat_opcina",transparent:!0,format:"image/png",zIndex:4}),katcestice=new L.NonTiledLayer.WMS(UrlGUP,{layers:"up4c:dkp_kat_cestica",transparent:!0,format:"image/png",zIndex:4}),zgrade=new L.NonTiledLayer.WMS(UrlGUP,{layers:"up4c:dkp_zgr",transparent:!0,format:"image/png",zIndex:2}),points=heatmap(),heat=L.heatLayer(points,{radius:25,blur:40}),obuhvat=[[42.6198453248053,18.0389116051422],[42.6921846048023,18.0389116051422],[42.6921846048023,18.157997051448],[42.6198453248053,18.157997051448],[42.6198453248053,18.0389116051422]],map=L.map("karta",{center:new L.LatLng(42.6535,18.11),zoom:13,minZoom:12,maxZoom:19,maxBounds:[[42.4148453248053,17.8269347626],[42.948126091674,18.357997051448]],layers:[dof_dgu,naselja],zoomControl:!1,twoFingerZoom:!0,tileSize:400});map.panTo(map.getCenter(obuhvat)),map.fitBounds(obuhvat);var baseMaps=[],overlays=[{groupName:"Upiti",expanded:!1,layers:{Heatmap:heat}},{groupName:"Mjere ure\u0111enja i za\u0161tite",expanded:!1,layers:{Naselja:naselja,"Urbana pravila":urbanapravila}}],control=L.Control.styledLayerControl(baseMaps,overlays,{autoZIndex:!1}),iconLayersControl=new L.Control.IconLayers([{title:"OSM",layer:osm,icon:"images/icons/osm_zagreb.jpg"},{title:"DOF",layer:dof_dgu,icon:"images/icons/zagreb_dof.jpg"},{title:"HOK",layer:hok_dgu,icon:"images/icons/zagreb_hok.jpg"},{title:"Bez podloge",layer:base,icon:""}],{position:"bottomright",maxLayersInRow:5});iconLayersControl.addTo(map);var markers=new L.MarkerClusterGroup,LeafIcon=L.Icon.extend({options:{iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[-3,-36]}}),greenIcon=new LeafIcon({iconUrl:"images/marker-icon-green.png"}),redIcon=new LeafIcon({iconUrl:"images/marker-icon-red.png"}),yellowIcon=new LeafIcon({iconUrl:"images/marker-icon-yellow.png"});map.on("load",Upiti()),window.setInterval(function(){Upiti()},18e4);var zoomHome=L.Control.zoomHome();zoomHome.addTo(map);var sidebar=L.control.sidebar("sidebar",{closeButton:!0,position:"left",autoPan:!1});map.addControl(sidebar),setTimeout(function(){sidebar.show()},1800),L.easyButton("fa-bars fa-lg sidebar",function(){sidebar.toggle(),alatiOff()},"Slojevi").addTo(map),$(".sidebar").parent().parent().parent().css("margin-bottom","15px");var lokacijskagumbOn=!1,infogumbOn=!1,posaljiUpitOn=!1,zajednicki=!1;$(document).ready(function(){$('button[title="Info"]').parent("div").append($("#alat2u1")),$('button[title="Info"]').parent("div").css("background-color","white")}),$("#alat2u1").hide(),L.easyButton("fa-info-circle fa-lg info",function(){0==zajednicki?(alatiOff(),otvoriIzbornik(),zajednicki=!0):alatiOff()},"Info").addTo(map),L.easyButton("fa fa-comments-o fa-lg upit",function(){0==posaljiUpitOn?(alatiOff(),$('button[title="Po\u0161alji upit"]').addClass("buttonOn"),helpCursor(),posaljiUpitOn=!0,map.on("click",posaljiUpit),$("#upit-help").show()):slanjeUpitaOff()},"Po\u0161alji upit").addTo(map),L.easyButton("fa fa-search fa-lg katastar",function(){alatiOff(),katastarOn()},"Prona\u0111i katastarsku \u010desticu").addTo(map),$(".katastar").parent().parent().parent().css("margin-bottom","15px"),L.easyButton("fa fa-question-circle fa-lg help",function(){alatiOff(),pokretanjeUvoda()},"Upute").addTo(map);var measureControl2=new L.Control.Measure({position:"topleft",primaryLengthUnit:"meters",secondaryLengthUnit:void 0,primaryAreaUnit:"sqmeters",secondaryAreaUnit:void 0}).addTo(map);L.control.scale({imperial:!1}).addTo(map),L.control.mousePosition({separator:" N = ",numDigits:8,prefix:"HTRS96/TM  E = "}).addTo(map);var isMobile={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return isMobile.Android()||isMobile.BlackBerry()||isMobile.iOS()||isMobile.Opera()||isMobile.Windows()}};if(isMobile.any()){setTimeout(function(){sidebar.hide()},1800);var centar=new L.LatLng(42.6535,18.11);map.setView(centar,18)}
