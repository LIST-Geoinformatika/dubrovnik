function deleteCestice(){cestice.clearLayers()}function deleteOpcine(){opcine.clearLayers()}function dohvatiKO(){upaliSloj(14),$.ajax({type:"GET",url:"php/getKatastar.php",contentType:"application/x-www-form-urlencoded;charset=utf-8",dataType:"json",success:function(a){for($("#opcina").find("option").remove().end().append("<option value></option>"),i=0;i<a.length;i++)$("#opcina").append('<option value="'+a[i].id+'">'+a[i].ko_naziv+"</option>");$("#opcina").trigger("chosen:updated")}})}function dohvatiVrstu(){document.getElementById("vrstakc").disabled=!1,$("#vrstakc").trigger("chosen:updated")}function dohvatiKC(){upaliSloj(15),document.getElementById("kc").disabled=!1,$.ajax({type:"GET",url:"php/getKC.php",data:{ko:odabranaKO,zgradnaKC:zgradnaKC},contentType:"application/x-www-form-urlencoded;charset=utf-8",dataType:"json",success:function(a){for($("#kc").find("option").remove().end().append("<option value></option>"),i=0;i<a.length;i++)$("#kc").append('<option value="'+a[i].id+'">'+a[i].kc_broj+"</option>");$("#kc").trigger("chosen:updated")}})}function prikaziCesticu(a){$.ajax({type:"GET",url:"php/postgis_geojson.php?geotable=v_dkp_kat_cestica&geomfield=geom&parameters=id="+odabranaKC,contentType:"application/x-www-form-urlencoded;charset=utf-8",dataType:"json",success:function(b){if("Polygon"==b.features[0].geometry.type){deleteCestice(),cestica=[];for(var c,d=0;d<b.features[0].geometry.coordinates[0].length;d++)c=[],c.push(b.features[0].geometry.coordinates[0][d][1]),c.push(b.features[0].geometry.coordinates[0][d][0]),cestica.push(c);L.polyline(cestica,{color:a,zIndex:15}).addTo(cestice),map.panTo(map.getCenter(cestica)),map.fitBounds(cestica)}else{polycestica=[];for(var c,d=0;d<b.features[0].geometry.coordinates.length;d++)for(var e=0;e<b.features[0].geometry.coordinates[d].length;e++){podcestica=[];for(var f=0;f<b.features[0].geometry.coordinates[d][e].length;f++)c=[],c.push(b.features[0].geometry.coordinates[d][e][f][1],b.features[0].geometry.coordinates[d][e][f][0]),podcestica.push(c);polycestica.push(podcestica)}L.multiPolyline(polycestica,{color:a,zIndex:15}).addTo(map),map.panTo(map.getCenter(polycestica)),map.fitBounds(polycestica)}}})}function prikaziOpcinu(){$.ajax({type:"GET",url:"php/postgis_geojson.php?geotable=dkp_kat_opcina&geomfield=geom&parameters=id="+odabranaKO+"&bbox=bbox",contentType:"application/x-www-form-urlencoded;charset=utf-8",dataType:"json",success:function(a){deleteOpcine(),opcina=[];for(var b,c=0;c<a.features[0].geometry.coordinates[0].length;c++)b=[],b.push(a.features[0].geometry.coordinates[0][c][1]),b.push(a.features[0].geometry.coordinates[0][c][0]),opcina.push(b);map.panTo(map.getCenter(opcina)),map.fitBounds(opcina)}})}function katastarOn(a){document.getElementById("kc").disabled=!0,document.getElementById("vrstakc").disabled=!0,resetModalPosition(),$("#opcina").find("option").remove(),$("#opcina").find("option:first-child").prop("selected",!0).end().trigger("chosen:updated"),$("#kc").find("option").remove(),$("#kc").find("option:first-child").prop("selected",!0).end().trigger("chosen:updated"),$("#vrstakc").find("option:first-child").prop("selected",!0).end().trigger("chosen:updated"),$("#modalKatastar").modal("show"),dohvatiKO()}var odabranaKO,odabranaKC,polygon,cestica,opcina,centar,podcestica,polycestica,cestice=new L.FeatureGroup;map.addLayer(cestice);var opcine=new L.FeatureGroup,zgradne;$("#opcina").chosen().change(function(){odabranaKO=$(this).val(),$("#vrstakc").find("option:first-child").prop("selected",!0).end().trigger("chosen:updated"),dohvatiVrstu(),prikaziOpcinu(),document.getElementById("kc").disabled=!0,$("#kc").find("option").remove(),$("#kc").find("option:first-child").prop("selected",!0).end().trigger("chosen:updated")}),$("#vrstakc").chosen().change(function(){zgradnaKC=$(this).val(),dohvatiKC()}),$("#kc").chosen().change(function(){odabranaKC=$(this).val(),prikaziCesticu("yellow")});